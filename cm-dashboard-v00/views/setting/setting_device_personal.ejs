<div id="main" style="height:850px;overflow-y:scroll">

    <button type="button" class="btn btn-primary" style="float: right;margin-top: 10px;margin-right: 10px"
        data-toggle="modal" data-target="#createdevice">新增 <%= type %></button>
    <!-- Modal-create -->
    <div class="modal fade" id="createdevice" tabindex="-1" role="dialog" aria-labelledby="createLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document" style="max-width:800px">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createLabel">新增 <%= type %> 設備</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form style="text-align: left" action="javascript:createvalue_device('device','<%= device_id %>')">
                        <label for="mac" class="col-form-label">識別碼：</label>
                        <input type="text" class="form-control" id="mac" required>
                        <label for="name" class="col-form-label">名稱:</label>
                        <input type="text" class="form-control" id="name" required>
                        <label for="description" class="col-form-label">描述:</label>
                        <input type="text" class="form-control" id="description">

                    

                        <label for="floor" class="col-form-label">樓層:</label>
                        <select class="form-control" id="floor" onchange="giveSelection(this.value)">
                            <option value="">暫無</option>
                            <% for(f=0;f<floor.length;f++) {%>
                            <option value='<%= floor[f].Number %>'><%= floor[f].Number %></option>
                            <% } %>
                        </select>
                        <%  %>

                        <label for="room" class="col-form-label">房號:</label>
                        <select id="room" class="form-control">
                            <% if(room[0].Number==null){ %>
                            <option value="">暫無</option>
                            <% }else{ %>
                            <option data-option="" value="">暫無</option>
                            <% for(r=0;r<room.length;r++) {%>
                            <option data-option='<%= room[r].FloorNumber %>' value='<%= room[r].Number %>'><%= room[r].Number %></option>
                            <% } %>
                            <% } %>
                        </select>

                        <script>
                            var sele1 = document.querySelector('#floor');
                            var sele2 = document.querySelector('#room');
                            var optionse2 = sele2.querySelectorAll('option');
                            function giveSelection(selValue) {
                            sele2.innerHTML =　'';
                                for(var i = 0; i < optionse2.length; i++) {
                                    if(optionse2[i].dataset.option === selValue) {
                                    sele2.appendChild(optionse2[i]);
                                    }
                                }
                            }
                            giveSelection(sele1.value);
                        </script>

                        <label for="user" class="col-form-label">使用者:</label>
                        <select class="form-control" id="user">
                            <option value="">暫無</option>
                            <% for(u=0;u<user.length;u++) {%>
                            <option value='<%= user[u].Username %>'><%= user[u].Username %></option>
                            <% } %>
                        </select>

                        <label for="service" class="col-form-label">服務UUID:</label>
                        <input type="text" class="form-control" id="service" required>
                        <label for="receive" class="col-form-label">接收UUID:</label>
                        <input type="text" class="form-control" id="receive" required>
                        <label for="send" class="col-form-label">發送UUID:</label>
                        <input type="text" class="form-control" id="send" required>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                            <button type="submit" class="btn btn-primary">確認</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <% if(device[0].id==null){ %>

    暫無資料請先點擊右方按鈕新增資料

    <% }else{ %>

    <table id="example">
        <thead>
            <tr>
                <th>識別碼</th>
                <th>名稱</th>
                <th>描述</th>
                <th>房號</th>
                <th>使用者</th>
                <th>服務UUID</th>
                <th>接收UUID</th>
                <th>發送UUID</th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            <% for(x=0;x<device.length;x++) {%>
            <tr>
                <% if(device[x].Mac == null) {%>
                <td>暫無</td>
                <% }else{ %>
                <td><%= device[x].Mac %></td>
                <% } %>
                <% if(device[x].Name == null) {%>
                <td>暫無</td>
                <% }else{ %>
                <td><%= device[x].Name %></td>
                <% } %>
                <% if(device[x].Description == null) {%>
                <td>暫無</td>
                <% }else{ %>
                <td><%= device[x].Description %></td>
                <% } %>
                <% if(device[x].RoomNumber == null) {%>
                <td>暫無</td>
                <% }else{ %>
                <td><%= device[x].RoomNumber %></td>
                <% } %>
                <% if(device[x].Username == null) {%>
                <td>暫無</td>
                <% }else{ %>
                <td><%= device[x].Username %></td>
                <% } %>
                <% if(device[x].ServiceUUID == null) {%>
                <td>暫無</td>
                <% }else{ %>
                <td><%= device[x].ServiceUUID %></td>
                <% } %>
                <% if(device[x].ReceiveUUID == null) {%>
                <td>暫無</td>
                <% }else{ %>
                <td><%= device[x].ReceiveUUID %></td>
                <% } %>
                <% if(device[x].SendUUID == null) {%>
                <td>暫無</td>
                <% }else{ %>
                <td><%= device[x].SendUUID %></td>
                <% } %>

                <td><button type="button" class="btn btn-info" data-toggle="modal"
                        data-target="#modal-<%= device[x].Mac %>-mod">修改</button>
                    <!-- Modal -->
                    <div class="modal fade" id="modal-<%= device[x].Mac %>-mod" tabindex="-1" role="dialog"
                        aria-labelledby="<%= device[x].Mac %>-Label-mod" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document" style="max-width:800px">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="<%= device[x].Mac %>-Label-mod">
                                        修改　<span
                                            style="font-size: 25px;font-style:italic"><%= device[x].Name %></span>　資料
                                    </h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form style="text-align: left">
                                        <label for="mac" class="col-form-label">識別碼：</label>
                                        <input type="text" class="form-control" value='<%= device[x].Mac %>'
                                            id="mac_modify<%= device[x].Mac %>" readonly>
                                        <label for="name" class="col-form-label">名稱:</label>
                                        <input type="text" class="form-control" value='<%= device[x].Name %>'
                                            id="name_modify<%= device[x].Mac %>">
                                        <label for="description" class="col-form-label">描述:</label>
                                        <% if(device[x].Description == null) {%>
                                        <input type="text" class="form-control" value="暫無"
                                            id="description_modify<%= device[x].Mac %>">
                                        <% }else{ %>
                                        <input type="text" class="form-control" value='<%= device[x].Description %>'
                                            id="description_modify<%= device[x].Mac %>">
                                        <% } %>

                                        <label for="floor" class="col-form-label">樓層:</label>
                                        <select id="floor_modify<%= device[x].Mac %>" class="form-control" onchange="giveSelection1('<%= device[x].Mac %>',this.value)">
                                            <% if(device[x].Floor == null) {%>
                                            <option value='' selected="selected">暫無</option>
                                            <% for(fg=0;fg<floor.length;fg++) {%>
                                            <option value='<%= floor[fg].Number %>'><%= floor[fg].Number %></option>
                                            <% } %>
                                            <% }else{ %>
                                            <option value=''>暫無</option>
                                            <% for( fgf=0;fgf<floor.length;fgf++) {%>
                                            <% if( device[x].Floor == floor[fgf].Number ) {%>
                                            <option value='<%= floor[fgf].Number %>' selected="selected">
                                                <%= floor[fgf].Number %></option>
                                            <% }else{ %>
                                            <option value='<%= floor[fgf].Number %>'><%= floor[fgf].Number %></option>
                                            <% } %>
                                            <% } %>
                                            <% } %>
                                        </select>

                                        <label for="room" class="col-form-label">房號:</label>
                                        <select id="room_modify<%= device[x].Mac %>" class="form-control">
                                            <% if(device[x].RoomNumber == null) {%>
                                            <option value='' selected="selected">暫無</option>
                                            <% for(rd=0;rd<room.length;rd++) {%>
                                            <option value='<%= room[rd].Number %>'><%= room[rd].Number %></option>
                                            <% } %>
                                            <% }else{ %>
                                            <option value='<%= device[x].RoomNumber %>' selected="selected" disabled>
                                                <%= device[x].RoomNumber %></option>
                                            <option value=''>暫無</option>
                                            <% for( rdr=0;rdr<room.length;rdr++) {%>
                                            <% if( device[x].RoomNumber != room[rdr].Number ) {%>
                                            <option value='<%= room[rdr].Number %>'><%= room[rdr].Number %></option>
                                            <% } %>
                                            <% } %>
                                            <% } %>
                                        </select>
                                        
                                        <script>
                                            var sel11;
                                            var sel22;
                                            var options22;
                                            function giveSelection1(id,selValue) {
                                                sel11 = document.querySelector('#floor_modify'+id);
                                                sel22 = document.querySelector('#room_modify'+id);
                                                options22 = sel22.querySelectorAll('option'); 
                                                sel22.innerHTML = '';
                                                for(var i = 0; i < optionse2.length; i++) {
                                                    if(optionse2[i].dataset.option === selValue) {
                                                        sel22.appendChild(optionse2[i]);
                                                    }
                                                }
                                            }
                                        </script>

                                        <label for="user" class="col-form-label">使用者:</label>
                                        <select id="user_modify<%= device[x].Mac %>" class="form-control">
                                            <% if(device[x].Username == null) {%>
                                            <option value='' selected="selected">暫無</option>
                                            <% for(ud=0;ud<user.length;ud++) {%>
                                            <option value='<%= user[ud].Username %>'><%= user[ud].Username %></option>
                                            <% } %>
                                            <% }else{ %>
                                            <option value='<%= device[x].Username %>' selected="selected" disabled>
                                                <%= device[x].Username %></option>
                                            <option value=''>暫無</option>
                                            <% for( udu=0;udu<user.length;udu++) {%>
                                            <!-- <% if( device[x].Username == user[udu].Username ) {%>
                                                <option value='<%= user[udu].Username %>' selected="selected"><%= user[udu].Username %></option>
                                                <% }else{ %>
                                                <option value='<%= user[udu].Username %>'><%= user[udu].Username %></option>
                                                <% } %> -->
                                            <% if( device[x].Username != user[udu].Username ) {%>
                                            <option value='<%= user[udu].Username %>'><%= user[udu].Username %></option>
                                            <% } %>
                                            <% } %>
                                            <% } %>
                                        </select>


                                        <label for="service" class="col-form-label">服務UUID:</label>
                                        <input type="text" class="form-control" value='<%= device[x].ServiceUUID %>'
                                            id="service_modify<%= device[x].Mac %>" readonly>
                                        <label for="receive" class="col-form-label">接收UUID:</label>
                                        <input type="text" class="form-control" value='<%= device[x].ReceiveUUID %>'
                                            id="receive_modify<%= device[x].Mac %>" readonly>
                                        <label for="send" class="col-form-label">發送UUID:</label>
                                        <input type="text" class="form-control" value='<%= device[x].SendUUID %>'
                                            id="send_modify<%= device[x].Mac %>" readonly>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                                    <button type="button" class="btn btn-primary" data-dismiss="modal"
                                        onclick="modifyvalue_device('device','<%= device[x].Mac %>','<%= device[x].Devicetype %>')">確認</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
                <td><button type="button" class="btn btn-secondary" data-toggle="modal"
                        data-target="#modal-<%= device[x].Mac %>-del">刪除</button>

                    <!-- Modal -->
                    <div class="modal fade" id="modal-<%= device[x].Mac %>-del" tabindex="-1" role="dialog"
                        aria-labelledby="<%= device[x].Mac %>-Label-del" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document" style="max-width:800px">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="<%= device[x].Mac %>-Label-del">
                                        刪除　<span
                                            style="font-size: 25px;font-style:italic"><%= device[x].Name %></span>　資料
                                    </h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form style="text-align: left">
                                        <label for="mac" class="col-form-label">指紋：</label>
                                        <input type="text" class="form-control" value='<%= device[x].Mac %>'
                                            id="mac_delete<%= device[x].Mac %>" readonly>

                                        <label for="name" class="col-form-label">名稱:</label>
                                        <input type="text" class="form-control" value='<%= device[x].Name %>'
                                            id="name_delete<%= device[x].Mac %>" readonly>

                                        <label for="description" class="col-form-label">描述:</label>
                                        <% if(device[x].Description == null) {%>
                                        <input type="text" class="form-control" readonly value="暫無">
                                        <% }else{ %>
                                        <input type="text" class="form-control" value='<%= device[x].Description %>'
                                            id="description_delete<%= device[x].Mac %>" readonly>
                                        <% } %>

                                        <label for="room" class="col-form-label">房號:</label>
                                        <% if(device[x].RoomNumber == null) {%>
                                        <input type="text" class="form-control" readonly value="暫無">
                                        <% }else{ %>
                                        <% for(dr=0;dr<room.length;dr++) {%>
                                        <% if(device[x].RoomNumber == room[dr].Number) {%>
                                        <input type="number" class="form-control" value='<%= room[dr].Number%>'
                                            readonly>
                                        <% } %>
                                        <% } %>
                                        <% } %>

                                        <label for="user" class="col-form-label">使用者:</label>
                                        <% if(device[x].Username == null) {%>
                                        <input type="text" class="form-control" readonly value="暫無">
                                        <% }else{ %>
                                        <% for(du=0;du<user.length;du++) {%>
                                        <% if(device[x].Username == user[du].Username) {%>
                                        <input type="text" class="form-control" value='<%= user[du].Username %>'
                                            readonly>
                                        <% } %>
                                        <% } %>
                                        <% } %>

                                        <label for="service" class="col-form-label">服務UUID:</label>
                                        <input type="text" class="form-control" value='<%= device[x].ServiceUUID %>'
                                            id="service_delete<%= device[x].Mac %>" readonly>

                                        <label for="receive" class="col-form-label">接收UUID:</label>
                                        <input type="text" class="form-control" value='<%= device[x].ReceiveUUID %>'
                                            id="receive_delete<%= device[x].Mac %>" readonly>
                                        <label for="send" class="col-form-label">發送UUID:</label>
                                        <input type="text" class="form-control" value='<%= device[x].SendUUID %>'
                                            id="send_delete<%= device[x].Mac %>" readonly>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                                    <button type="button" class="btn btn-primary" data-dismiss="modal"
                                        onclick="deletevalue_device('device','<%= device[x].Mac %>','<%= device[x].Devicetype %>')">確認</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
            <% } %>
        </tbody>
    </table>

    <script>
        $(document).ready(function () {
            $('#example').DataTable({
                language: {
                    search: "搜尋：",
                    sProcessing: "处理中...",
                    sLengthMenu: "显示 _MENU_ 项结果",
                    sZeroRecords: "没有匹配结果",
                    sInfo: "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
                    sInfoEmpty: "显示第 0 至 0 项结果，共 0 项",
                    sInfoFiltered: "(由 _MAX_ 项结果过滤)",
                    sInfoPostFix: "",
                    sSearch: "搜索:",
                    sEmptyTable: "表中数据为空",
                    sLoadingRecords: "载入中...",
                    sInfoThousands: ",",
                    oPaginate: {
                        sFirst: "首页",
                        sPrevious: "上页",
                        sNext: "下页",
                        sLast: "末页"
                    },
                    oAria: {
                        "sSortAscending": ": 以升排列",
                        "sSortDescending": ": 以降排列"
                    }
                }
            });
        });
    </script>

    <% } %>
</div>